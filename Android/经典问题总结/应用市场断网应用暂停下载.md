# 问题描述

应用时长将多个APP点击开始下载，然后灭屏2分钟之后，打开应用市场发现下载状态全部改变为了暂停状态，经过应用市场的分析ConnectActivityService获取到的网络状态为没有网络，因此将下载状态改为了暂停。

# 测试步骤

* 1、将应用市场的所有APP点击开始下载
* 2、灭屏等待2分钟之后查看APP的下载状态


# 分析过程

* 1、该问题最初由应用市场分析，应用市场在代码中打印ConnectActivityService获得的状态为没有网络，因此将问题交给了网络同事
* 2、网络同事通过Android日志当中的ConnectActivityService打印的状态确认在这种情况下网络没有出现断链的情况，并且系统中的PUSH模块还可以正常* 网络交互，最后将问题交给系统分析
* 3、我经过和测试沟通，了解测试手法之后，将Android日志按照时间进行划分，通过一行一行查看日志后发现当出现问题时ConnectActivityService没有断网，但是系统存在LIGHT到IDLE状态的切换
* 4、通过查看DeviceIdleController的源码发现，当系统进入IDLE后会管控每个应用的网络
* 5、因此大胆猜想让应用市场持CPU唤醒锁，不让进入休眠即可
* 6、根据上述分析最终原因：由于灭屏系统进入doze导致不持CPU锁的应用不能使用网络，从而获取到的状态不对。


# 解决方案

1、需要应用市场如果要长时间下载必须持PowerManager的部分唤醒锁
# 方案业务
夜间模式是华为儿童手表在进入夜间之后对手表联网进行管理的一项方案，该方案实现了夜间断网、自动联网的功能，从而降低手表在夜间模式下的网络造成的功耗问题，

# 方案设计

* 1、由systemUI注册亮屏广播
* 2、手机侧配置夜间模式开关和时间
* 3、由Setting值通知需要的模块

# 方案实现

* 1、监听灭屏广播ACTION_SCREEN_OFF
* 2、先判断当前是否属于夜间模式时间段，即就是当前时间的分钟数是否在0至1440对应的范围内
* 3、其次判断当前是否已经处于夜间模式
* 4、通过ConnectActivityService判断手机卡状态，手机卡是否处于停机、欠费等状态
* 5、检查目前是否有下载等一些重要需要联网的应用
* 6、将当前的模式状态写入setting当中
* 7、其余模块监听对应setting值的改变，做出对应的处理
* 8、如果不进入夜间模式则使用AlarmManagerService添加一个20分钟为周期的Alarm
* 9、在Alarm唤醒后执行夜间模式业务的判断
* 10、网络控制模块注册夜间模式的setting值，如果处于夜间模式则关闭WiFi和数据流量
* 11、如果退出夜间模式则恢复之前的状态
* 12、如果PUSH、亮屏等需要联网的情况下主动退出夜间模式恢复网络